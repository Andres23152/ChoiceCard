<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title id="pageTitle">HSHP Course Request Inquiry (10th Grade)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #ffe6e6; 
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border: 1px solid #b71c1c; 
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 4px solid #b71c1c;
      padding-bottom: 15px;
    }
    .logo {
      width: 80px;
      height: auto;
    }
    h1 {
      font-size: 1.8em;
      color: #b71c1c;
      margin: 0;
      font-weight: bold;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    textarea, input {
      width: 100%;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      font-size: 1em;
    }
    .button-container {
      text-align: center;
      margin-top: 20px;
    }
    button {
      background-color: #d32f2f; 
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    button:hover {
      background-color: #b71c1c;
    }
    .student-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #ffebee;
      border: 1px solid #ffcdd2;
      border-radius: 4px;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.8em;
      color: #666;
      border-top: 2px solid #b71c1c;
      padding-top: 10px;
    }
    .thank-you {
      background-color: #fff3f3;
      border: 1px solid #ffcdd2;
      color: #b71c1c;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      text-align: center;
    }
    .thank-you h1 {
      margin-bottom: 10px;
      font-size: 1.6em;
      color: #b71c1c;
    }
    .thank-you a {
      color: #b71c1c;
      text-decoration: underline;
    }
    .note {
      font-size: 15px;
      color: #b71c1c;
      margin-top: 20px;
      font-style: italic;
      text-align: center;
    }
    ul li {
      margin-bottom: 8px;
    }

    /* Center the translate button at the top */
    #translate-button-container {
      text-align: center;
      margin: 15px 0;
    }
    #translate-button {
      font-size: 1.2em;
      padding: 10px 30px;
      background-color: #ffc107; /* A bright color to stand out */
      color: #333;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #translate-button:hover {
      background-color: #ffb300;
    }

  </style>
</head>
<body>
  <!-- TRANSLATE BUTTON -->
  <div id="translate-button-container">
    <button id="translate-button" onclick="toggleLanguage()">Spanish</button>
  </div>

  <div class="container" id="main-container">
    <!-- HEADER -->
    <div class="header">
      <h1 id="titleStatic">Course Request Inquiry for <span id="loadingStudentName">Loading...</span></h1>
      <img 
        src="https://hshpnews.wordpress.com/wp-content/uploads/2015/11/logo-hshp.png?w=410&h=310"
        alt="HSHP Logo"
        class="logo"
      >
    </div>

    <p id="instructions">
      Please review the following <strong>10th grade</strong> course requests. 
      If you have questions or concerns, please complete the form below to request a callback.
    </p>

    <!-- STUDENT INFO PLACEHOLDER -->
    <div id="student-info" class="student-info">
      <p><strong>Student ID:</strong> <span id="loadingStudentID">Loading...</span></p>
      <h3 id="coursesHeader">Course Requests:</h3>
      <ul>
        <li><strong>English:</strong> <span id="englishCourse">Loading...</span></li>
        <li><strong>Mathematics:</strong> <span id="mathCourse">Loading...</span></li>
        <li><strong>Science:</strong> <span id="scienceCourse">Loading...</span></li>
        <li><strong>Social Studies:</strong> <span id="socialStudiesCourse">Loading...</span></li>
        <li><strong>Health Science:</strong> <span id="healthScienceCourse">Loading...</span></li>
        <li><strong>Foreign Language:</strong> <span id="foreignLanguageCourse">Loading...</span></li>
        <li><strong>Fine Arts:</strong> <span id="fineArtsCourse">Loading...</span></li>
        <li><strong>Physical Education:</strong> <span id="peCourse">Loading...</span></li>
        <li><strong>Electives:</strong> <span id="electivesCourse">Loading...</span></li>
      </ul>

      <!-- LVN Program -->
      <h3 id="lvnHeader">LVN Program:</h3>
      <ul>
        <li><strong id="lvnInterestLabel">Interested in LVN Program for Junior Year?</strong> <span id="lvnInterest">Loading...</span></li>
      </ul>

      <!-- Off-Campus Extracurricular -->
      <h3 id="offCampusHeader">Off-Campus Extracurricular:</h3>
      <ul>
        <li><strong id="participatingLabel">Participating?</strong> <span id="extracurricularParticipating">Loading...</span></li>
        <li><strong id="activityNameLabel">Activity Name:</strong> <span id="extracurricularName">Loading...</span></li>
        <li><strong id="coachPermissionLabel">Coach's Permission:</strong> <span id="coachesPermission">Loading...</span></li>
        <li><strong id="zoneLabel">Zone/Home Campus:</strong> <span id="zoneCampus">Loading...</span></li>
      </ul>
    </div>

    <!-- FORM FOR CALLBACK -->
    <div id="response-container">
      <label for="phone" id="phoneLabel">Parent Contact Number (required):</label>
      <input type="tel" id="phone" placeholder="(XXX) XXX-XXXX" required maxlength="14">
      
      <label for="comments" id="commentsLabel">Please describe your questions or concerns (required):</label>
      <textarea id="comments" placeholder="Enter your questions or concerns here"></textarea>
      
      <div class="button-container">
        <button type="button" id="submit-button" onclick="handleSubmit()">
          Request Callback
        </button>
      </div>
    </div>

    <p class="note" id="noteText">
      We will contact you at the provided phone number to discuss your inquiry.
    </p>

    <!-- FOOTER -->
    <div class="footer">
      <p id="footerCopyright">
        &copy; 2025 Harlingen School of Health Professions. For internal use only.
      </p>
      <p id="footerContact">
        If you have any questions or concerns, please contact Mrs. Perez at 
        <a href="mailto:magdalena.lopez-perez@hcisd.org">magdalena.lopez-perez@hcisd.org</a>.
      </p>
      <div id="error-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background-color:white; border:1px solid #b71c1c; padding:20px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:1000;">
        <p id="error-message" style="color:#b71c1c; font-weight:bold; text-align:center;"></p>
        <button onclick="closeModal()" style="background-color:#d32f2f; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">Close</button>
      </div>
      <div id="overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>
    </div>
  </div>

  <script>
    /***************************************************************
     * 1) Define translations for all static text in English/Spanish
     ***************************************************************/
    const translations = {
      en: {
        pageTitle: "HSHP Course Request Inquiry (10th Grade)",
        titleStatic: "Course Request Inquiry for",
        instructions: "Please review the following <strong>10th grade</strong> course requests. If you have questions or concerns, please complete the form below to request a callback.",
        phoneLabel: "Parent Contact Number (required):",
        commentsLabel: "Please describe your questions or concerns (required):",
        callbackButton: "Request Callback",
        noteText: "We will contact you at the provided phone number to discuss your inquiry.",
        footerCopyright: "© 2025 Harlingen School of Health Professions. For internal use only.",
        footerContact: "If you have any questions or concerns, please contact Mrs. Perez at <a href=\"mailto:magdalena.lopez-perez@hcisd.org\">magdalena.lopez-perez@hcisd.org</a>.",
        coursesHeader: "Course Requests:",
        lvnHeader: "LVN Program:",
        lvnInterestLabel: "Interested in LVN Program for Junior Year?",
        offCampusHeader: "Off-Campus Extracurricular:",
        participatingLabel: "Participating?",
        activityNameLabel: "Activity Name:",
        coachPermissionLabel: "Coach's Permission:",
        zoneLabel: "Zone/Home Campus:",
        errorLoadingDataTitle: "Error Loading Data",
        errorLoadingDataMessage: "We could not find data for the Student ID provided. Please contact support.",
        errorFetchingData: "An error occurred while fetching the data. Please try again later.",
        thankYouTitle: "Thank You!",
        thankYouMessage: "Your inquiry has been successfully submitted for the 10th grade course requests. We will contact you soon at the phone number provided.",
        inquiryAlreadySubmittedTitle: "Inquiry Already Submitted",
        inquiryAlreadySubmittedMessage: "You have already submitted an inquiry for these 10th grade course requests. We will contact you soon at the phone number provided.",
        phoneNumberError: "Please enter a valid 10-digit phone number.",
        commentsError: "Please describe your questions or concerns.",
        fetchError: "An error occurred. Please try again.",
        translateButton: "Spanish"
      },
      es: {
        pageTitle: "Solicitud de consulta de cursos de HSHP (10º grado)",
        titleStatic: "Consulta de solicitud de cursos para",
        instructions: "Por favor revise las siguientes <strong>solicitudes de cursos de 10° grado</strong>. Si tiene preguntas o inquietudes, por favor complete el formulario a continuación para solicitar una devolución de llamada.",
        phoneLabel: "Número de contacto de los padres (requerido):",
        commentsLabel: "Por favor describa sus preguntas o inquietudes (requerido):",
        callbackButton: "Solicitar devolución de llamada",
        noteText: "Nos pondremos en contacto con usted en el número de teléfono proporcionado para discutir su consulta.",
        footerCopyright: "© 2025 Escuela de Profesiones de la Salud de Harlingen. Solo para uso interno.",
        footerContact: "Si tiene alguna pregunta o inquietud, comuníquese con la Sra. Perez en <a href=\"mailto:magdalena.lopez-perez@hcisd.org\">magdalena.lopez-perez@hcisd.org</a>.",
        coursesHeader: "Solicitudes de cursos:",
        lvnHeader: "Programa de LVN:",
        lvnInterestLabel: "¿Interesado en el programa de LVN para el tercer año?",
        offCampusHeader: "Actividades extracurriculares fuera del campus:",
        participatingLabel: "¿Participando?",
        activityNameLabel: "Nombre de la actividad:",
        coachPermissionLabel: "Permiso del entrenador:",
        zoneLabel: "Zona/escuela de origen:",
        errorLoadingDataTitle: "Error al cargar los datos",
        errorLoadingDataMessage: "No pudimos encontrar datos para la identificación de estudiante proporcionada. Por favor contacte al soporte.",
        errorFetchingData: "Ocurrió un error al obtener los datos. Por favor intente de nuevo más tarde.",
        thankYouTitle: "¡Gracias!",
        thankYouMessage: "Su consulta ha sido enviada con éxito para las solicitudes de cursos de 10° grado. Nos comunicaremos con usted pronto al número de teléfono proporcionado.",
        inquiryAlreadySubmittedTitle: "Consulta ya enviada",
        inquiryAlreadySubmittedMessage: "Ya ha enviado una consulta para estas solicitudes de cursos de 10° grado. Nos comunicaremos con usted pronto al número de teléfono proporcionado.",
        phoneNumberError: "Por favor ingrese un número de teléfono válido de 10 dígitos.",
        commentsError: "Por favor describa sus preguntas o inquietudes.",
        fetchError: "Ocurrió un error. Por favor intente de nuevo.",
        translateButton: "English"
      }
    };

    // Keep track of current language (default English)
    let currentLanguage = 'en';

    /************************************************************************
     * 2) A function that updates static text on the page based on language
     ************************************************************************/
    function updateText(lang) {
      // Update the <title> element
      document.getElementById('pageTitle').textContent = translations[lang].pageTitle;
      
      // Update all other text by IDs
      document.getElementById('titleStatic').textContent = translations[lang].titleStatic + " ";
      document.getElementById('instructions').innerHTML = translations[lang].instructions; 
      document.getElementById('phoneLabel').textContent = translations[lang].phoneLabel;
      document.getElementById('commentsLabel').textContent = translations[lang].commentsLabel;
      document.getElementById('submit-button').textContent = translations[lang].callbackButton;
      document.getElementById('noteText').textContent = translations[lang].noteText;
      document.getElementById('footerCopyright').textContent = translations[lang].footerCopyright;
      document.getElementById('footerContact').innerHTML = translations[lang].footerContact;
      document.getElementById('coursesHeader').textContent = translations[lang].coursesHeader;
      document.getElementById('lvnHeader').textContent = translations[lang].lvnHeader;
      document.getElementById('lvnInterestLabel').textContent = translations[lang].lvnInterestLabel;
      document.getElementById('offCampusHeader').textContent = translations[lang].offCampusHeader;
      document.getElementById('participatingLabel').textContent = translations[lang].participatingLabel;
      document.getElementById('activityNameLabel').textContent = translations[lang].activityNameLabel;
      document.getElementById('coachPermissionLabel').textContent = translations[lang].coachPermissionLabel;
      document.getElementById('zoneLabel').textContent = translations[lang].zoneLabel;
      document.getElementById('translate-button').textContent = translations[lang].translateButton;
    }

    /************************************************************************
     * 3) Toggle language function for the big button at the top
     ************************************************************************/
    function toggleLanguage() {
      currentLanguage = (currentLanguage === 'en') ? 'es' : 'en';
      updateText(currentLanguage);
    }

    /************************************************************************
     * 4) Original logic for fetching data from SharePoint (Flow endpoint)
     ************************************************************************/
    const FLOW_ENDPOINT =
      "https://prod-51.westus.logic.azure.com:443/workflows/972d756d204149d39f15c368394b6075/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=HYhiocLYasW9SGQpEJa_dxlShKYpViS_A_dhibE9c4Y";

    const INQUIRY_ENDPOINT =
      "https://prod-113.westus.logic.azure.com:443/workflows/c44d6591680741439c0412250fc8edd3/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=GS6_KY-4ZGDk2EqpUbptxMHlwqUMH83UZjB7l6zq_hk";

    // Query parameters for Student ID, FirstName, LastName
    const queryParams = new URLSearchParams(window.location.search);
    const studentID = queryParams.get("StudentID") || "Unknown";
    const firstName = queryParams.get("FirstName") || "";
    const lastName = queryParams.get("LastName") || "";

    // 1) Fetch student info on load
    async function fetchStudentInfo() {
      try {
        const response = await fetch(
          `${FLOW_ENDPOINT}&StudentID=${studentID}&FirstName=${firstName}&LastName=${lastName}`
        );
        const data = await response.json();

        if (data) {
          // If an inquiry is already submitted: ParentResponse = "Rejected"
          if (data.ParentResponse === "Rejected") {
            document.getElementById("main-container").innerHTML = `
              <div class="thank-you">
                <h1 id="inquiryAlreadySubmittedTitle">${translations[currentLanguage].inquiryAlreadySubmittedTitle}</h1>
                <p id="inquiryAlreadySubmittedMessage">${translations[currentLanguage].inquiryAlreadySubmittedMessage}</p>
              </div>
            `;
            return;
          }

          // Update Title
          document.getElementById("loadingStudentName").textContent =
            `${data.FirstName || "Student"} ${data.LastName || ""}`;

          // Populate the 10th grade data
          document.getElementById("loadingStudentID").textContent = studentID;
          document.getElementById("englishCourse").textContent = data.English || "Not Provided";
          document.getElementById("mathCourse").textContent = data.Mathematics || "Not Provided";
          document.getElementById("scienceCourse").textContent = data.Science || "Not Provided";
          document.getElementById("socialStudiesCourse").textContent = data.SocialStudies || "Not Provided";
          document.getElementById("healthScienceCourse").textContent = data.HealthScience || "Not Provided";
          document.getElementById("foreignLanguageCourse").textContent = data.ForeignLanguage || "Not Provided";
          document.getElementById("fineArtsCourse").textContent = data.FineArts || "Not Provided";
          document.getElementById("peCourse").textContent = data.PhysicalEducation || "Not Provided";
          document.getElementById("electivesCourse").textContent = data.Electives || "Not Provided";
          document.getElementById("lvnInterest").textContent = data.LVN_x003f_ || "Not Provided";
          document.getElementById("extracurricularParticipating").textContent = data.OffCampusExtracurricular || "Not Provided";
          document.getElementById("extracurricularName").textContent = data.ExtracurricularName || "Not Provided";
          document.getElementById("coachesPermission").textContent = data.CoachesPermission || "Not Provided";
          document.getElementById("zoneCampus").textContent = data.ZoneCampus || "Not Provided";

        } else {
          document.getElementById("main-container").innerHTML = `
            <h1>${translations[currentLanguage].errorLoadingDataTitle}</h1>
            <p>${translations[currentLanguage].errorLoadingDataMessage}</p>
          `;
        }
      } catch (error) {
        console.error("Error fetching data:", error);
        document.getElementById("main-container").innerHTML = `
          <h1>${translations[currentLanguage].errorLoadingDataTitle}</h1>
          <p>${translations[currentLanguage].errorFetchingData}</p>
        `;
      }
    }

    // 2) Format phone input as user types (optional)
    document.addEventListener("DOMContentLoaded", () => {
      // Set initial language to English
      updateText('en');

      const phoneInput = document.getElementById("phone");
      if (phoneInput) {
        phoneInput.addEventListener("input", (e) => {
          let input = e.target.value.replace(/\D/g, "");
          let formatted = "";
          if (input.length > 0) {
            formatted += "(" + input.substring(0, 3);
          }
          if (input.length >= 4) {
            formatted += ") " + input.substring(3, 6);
          }
          if (input.length >= 7) {
            formatted += "-" + input.substring(6, 10);
          }
          e.target.value = formatted;
        });
      }
      fetchStudentInfo();
    });

    // 3) Submit callback request
    function showError(message) {
      document.getElementById("error-message").textContent = message;
      document.getElementById("error-modal").style.display = "block";
      document.getElementById("overlay").style.display = "block";
    }

    function closeModal() {
      document.getElementById("error-modal").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function handleSubmit() {
      const phone = document.getElementById("phone").value.trim();
      const comments = document.getElementById("comments").value.trim();

      // Basic phone validation: must have 14 chars => "(XXX) XXX-XXXX"
      if (!phone || phone.length !== 14) {
        showError(translations[currentLanguage].phoneNumberError);
        return;
      }
      if (!comments) {
        showError(translations[currentLanguage].commentsError);
        return;
      }

      const submitButton = document.getElementById("submit-button");
      submitButton.disabled = true;
      submitButton.textContent = "Submitting...";

      // Using "Rejected" to indicate an inquiry was submitted
      const payload = {
        StudentID: studentID,
        FirstName: firstName,
        LastName: lastName,
        ParentPhoneNumber: phone,
        ParentResponse: "Rejected",
        Comments: comments
      };

      fetch(INQUIRY_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      })
        .then((response) => {
          if (response.ok) {
            document.getElementById("main-container").innerHTML = `
              <div class="thank-you">
                <h1>${translations[currentLanguage].thankYouTitle}</h1>
                <p>${translations[currentLanguage].thankYouMessage}</p>
              </div>
            `;
          } else {
            throw new Error("Submission failed.");
          }
        })
        .catch(() => {
          alert(translations[currentLanguage].fetchError);
          submitButton.disabled = false;
          submitButton.textContent = translations[currentLanguage].callbackButton;
        });
    }
  </script>
</body>
</html>
