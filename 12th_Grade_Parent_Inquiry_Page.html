<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>HSHP Course Request Inquiry (12th Grade)</title>
  <style>
    /* 
      Using the same pinkish/red scheme (#ffe6e6 / #b71c1c) for consistency 
      with your other inquiry pages.
    */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #ffe6e6;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border: 1px solid #b71c1c;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 4px solid #b71c1c;
      padding-bottom: 15px;
    }
    .logo {
      width: 80px;
      height: auto;
    }
    h1 {
      font-size: 1.8em;
      color: #b71c1c;
      margin: 0;
      font-weight: bold;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    textarea, input {
      width: 100%;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      font-size: 1em;
    }
    .button-container {
      text-align: center;
      margin-top: 20px;
    }
    button {
      background-color: #d32f2f;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      font-size: 1em;
      cursor: pointer;
    }
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    button:hover {
      background-color: #b71c1c;
    }
    .student-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #ffebee;
      border: 1px solid #ffcdd2;
      border-radius: 4px;
    }
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.8em;
      color: #666;
      border-top: 2px solid #b71c1c;
      padding-top: 10px;
    }
    .thank-you {
      background-color: #fff3f3;
      border: 1px solid #ffcdd2;
      color: #b71c1c;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      text-align: center;
    }
    .thank-you h1 {
      margin-bottom: 10px;
      font-size: 1.6em;
      color: #b71c1c;
    }
    .thank-you a {
      color: #b71c1c;
      text-decoration: underline;
    }
    .note {
      font-size: 15px;
      color: #b71c1c;
      margin-top: 20px;
      font-style: italic;
      text-align: center;
    }
    ul li {
      margin-bottom: 8px;
    }
    body > .skiptranslate,.goog-logo-link,.gskiptranslate,.goog-te-gadget span,.goog-te-banner-frame,#goog-gt-tt, .goog-te-balloon-frame,div#goog-gt-{
  display: none!important;
}
.goog-te-gadget {
  color: transparent!important;
  font-size:0px;
}
.goog-text-highlight {
  background: none !important;
  box-shadow: none !important;
}
#google_translate_element select {
  background: #0099ae;
  color: #ffffff;
  border: 5px solid #000000;
  font-weight: bold;
  text-align: center;
  border-radius: 3px;
  padding: 8px 12px;
  font-size: 20px;
  width: 220px;
  height: 50px;
}
.translate-container {
  margin-left: 10px; /* Shift only the Google Translate element */
  align-items: center;
}
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <div id="translate-wrapper">
      <div id='google_translate_element'></div>
  </div><br>
    <!-- HEADER -->
    <div class="header">
      <h1 id="title">Course Request Inquiry for Loading...</h1>
      <img
        src="https://hshpnews.wordpress.com/wp-content/uploads/2015/11/logo-hshp.png?w=410&h=310"
        alt="HSHP Logo"
        class="logo"
      />
    </div>

    <p>
      Please review the following <strong>12th grade</strong> course requests. If you have questions or concerns,
      please complete the form below to request a callback.
    </p>

    <!-- STUDENT INFO PLACEHOLDER -->
    <div id="student-info" class="student-info">
      <p><strong>Student ID:</strong> Loading...</p>
      <h3>Course Requests:</h3>
      <ul>
        <li><strong>English:</strong> Loading...</li>
        <li><strong>Social Studies:</strong> Loading...</li>
        <li><strong>Practicum:</strong> Loading...</li>
        <li><strong>Electives:</strong> Loading...</li>
      </ul>

      <h3>Off-Campus Extracurricular:</h3>
      <ul>
        <li><strong>Participating?</strong> Loading...</li>
        <li><strong>Activity Name:</strong> Loading...</li>
        <li><strong>Coach's Permission:</strong> Loading...</li>
        <li><strong>Zone/Home Campus:</strong> Loading...</li>
      </ul>
    </div>

    <!-- CALLBACK FORM -->
    <div id="response-container">
      <label for="phone">Parent Contact Number (required):</label>
      <input type="tel" id="phone" placeholder="(XXX) XXX-XXXX" required maxlength="14">

      <label for="comments">Please describe your questions or concerns (required):</label>
      <textarea id="comments" placeholder="Enter your questions or concerns here"></textarea>

      <div class="button-container">
        <button type="button" id="submit-button" onclick="handleSubmit()">
          Request Callback
        </button>
      </div>
    </div>

    <p class="note">We will contact you at the provided phone number to discuss your inquiry.</p>

    <!-- FOOTER -->
    <div class="footer">
      <p>&copy; 2025 Harlingen School of Health Professions. For internal use only.</p>
      <p>
        If you have any questions or concerns, please feel free to contact us.
      </p>
    </div>
    <div id="error-modal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background-color:white; border:1px solid #b71c1c; padding:20px; border-radius:10px; box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:1000;">
      <p id="error-message" style="color:#b71c1c; font-weight:bold; text-align:center;"></p>
      <button onclick="closeModal()" style="background-color:#d32f2f; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">Close</button>
    </div>
    <div id="overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>
  </div>

  <script>
    /*
     * FLOW_ENDPOINT: Logic App to fetch 12th grade student data
     * INQUIRY_ENDPOINT: Logic App to submit parent's inquiry (ParentResponse = "Rejected")
     * Adjust these to your actual endpoints.
     */
    const FLOW_ENDPOINT =
      "https://prod-51.westus.logic.azure.com:443/workflows/972d756d204149d39f15c368394b6075/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=HYhiocLYasW9SGQpEJa_dxlShKYpViS_A_dhibE9c4Y";

    const INQUIRY_ENDPOINT =
      "https://prod-113.westus.logic.azure.com:443/workflows/c44d6591680741439c0412250fc8edd3/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=GS6_KY-4ZGDk2EqpUbptxMHlwqUMH83UZjB7l6zq_hk";

    // Retrieve query params
    const queryParams = new URLSearchParams(window.location.search);
    const studentID = queryParams.get("StudentID") || "Unknown";
    const firstName = queryParams.get("FirstName") || "";
    const lastName = queryParams.get("LastName") || "";

    // 1) Format phone input as user types
    document.addEventListener("DOMContentLoaded", () => {
      const phoneInput = document.getElementById("phone");
      if (phoneInput) {
        phoneInput.addEventListener("input", (e) => {
          let input = e.target.value.replace(/\D/g, "");
          let formatted = "";
          if (input.length > 0) {
            formatted += "(" + input.substring(0, 3);
          }
          if (input.length >= 4) {
            formatted += ") " + input.substring(3, 6);
          }
          if (input.length >= 7) {
            formatted += "-" + input.substring(6, 10);
          }
          e.target.value = formatted;
        });
      }
      fetchStudentInfo();
    });

    // 2) Fetch 12th grade course info
    async function fetchStudentInfo() {
      try {
        const response = await fetch(
          `${FLOW_ENDPOINT}&StudentID=${studentID}&FirstName=${firstName}&LastName=${lastName}`
        );
        const data = await response.json();

        if (data) {
          // If ParentResponse = "Rejected", means inquiry was already submitted
          if (data.ParentResponse === "Rejected") {
            document.getElementById("main-container").innerHTML = `
              <div class="thank-you">
                <h1>Inquiry Already Submitted</h1>
                <p>You have already submitted an inquiry for these 12th grade course requests.</p>
                <p>We will contact you soon at the phone number you provided.</p>
              </div>
            `;
            return;
          }

          // Update Title
          document.querySelector("#title").textContent = 
            `Course Request Inquiry for ${data.FirstName || "Student"} ${data.LastName || ""}`;

          // Populate 12th grade data
          document.querySelector("#student-info").innerHTML = `
            <p><strong>Student ID:</strong> ${studentID}</p>
            <h3>Course Requests:</h3>
            <ul>
              <li><strong>English:</strong> ${data.English || "Not Provided"}</li>
              <li><strong>Social Studies:</strong> ${data.SocialStudies || "Not Provided"}</li>
              <li><strong>Practicum:</strong> ${data.Practicum || "Not Provided"}</li>
              <li><strong>Electives:</strong> ${data.Electives || "Not Provided"}</li>
            </ul>
            <h3>Off-Campus Extracurricular:</h3>
            <ul>
              <li><strong>Participating?</strong> ${data.OffCampusExtracurricular || "Not Provided"}</li>
              <li><strong>Activity Name:</strong> ${data.ExtracurricularName || "Not Provided"}</li>
              <li><strong>Coach's Permission:</strong> ${data.CoachesPermission || "Not Provided"}</li>
              <li><strong>Zone/Home Campus:</strong> ${data.ZoneCampus || "Not Provided"}</li>
            </ul>
            <p class="note">
              Please Note: These course requests are subject to change due to course
              availability and other scheduling factors.
            </p>
          `;
        } else {
          document.getElementById("main-container").innerHTML = `
            <h1>Error Loading Data</h1>
            <p>We could not find data for the Student ID provided. Please contact support.</p>
          `;
        }
      } catch (error) {
        console.error("Error fetching data:", error);
        document.getElementById("main-container").innerHTML = `
          <h1>Error Loading Data</h1>
          <p>An error occurred while fetching data. Please try again later.</p>
        `;
      }
    }

    // 3) Submit inquiry
    function showError(message) {
    document.getElementById("error-message").textContent = message;
    document.getElementById("error-modal").style.display = "block";
    document.getElementById("overlay").style.display = "block";
  }

  function closeModal() {
    document.getElementById("error-modal").style.display = "none";
    document.getElementById("overlay").style.display = "none";
  }

  function handleSubmit() {
    const phone = document.getElementById("phone").value.trim();
    const comments = document.getElementById("comments").value.trim();

    if (!phone || phone.length !== 14) {
      showError("Please enter a valid 10-digit phone number.");
      return;
    }
    if (!comments) {
      showError("Please describe your questions or concerns.");
      return;
    }

      const submitButton = document.getElementById("submit-button");
      submitButton.disabled = true;
      submitButton.textContent = "Submitting...";

      // "Rejected" indicates an inquiry was submitted, as with the other pages
      const payload = {
        StudentID: studentID,
        FirstName: firstName,
        LastName: lastName,
        ParentPhoneNumber: phone,
        ParentResponse: "Rejected",
        Comments: comments
      };

      fetch(INQUIRY_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      })
        .then((response) => {
          if (response.ok) {
            document.getElementById("main-container").innerHTML = `
              <div class="thank-you">
                <h1>Thank You!</h1>
                <p>Your inquiry has been successfully submitted for the 12th grade course requests.</p>
                <p>We will contact you soon at the phone number you provided.</p>
              </div>
            `;
          } else {
            throw new Error("Submission failed.");
          }
        })
        .catch(() => {
          alert("An error occurred. Please try again.");
          submitButton.disabled = false;
          submitButton.textContent = "Request Callback";
        });
    }
  </script>
     <script>
      function googleTranslateElementInit() {
          new google.translate.TranslateElement({
              pageLanguage: 'en',
              autoDisplay: 'true',
              includedLanguages:'es,en',
              layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL
          }, 'google_translate_element');
      }
     </script>
     <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
